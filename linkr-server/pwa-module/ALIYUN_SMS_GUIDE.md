# é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡æ¥å…¥æŒ‡å?

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡å·²é›†æˆå®Œæˆï¼Œæ”¯æŒæ‰‹æœºå·æ³¨å†Œ/ç™»å½•çš„éªŒè¯ç å‘é€å’ŒéªŒè¯åŠŸèƒ½ã€‚åŒ…æ‹¬åç«¯çŸ­ä¿¡æœåŠ¡ã€å‰ç«¯éªŒè¯ç UIã€Redisç¼“å­˜ã€å‘é€é™åˆ¶ç­‰å®Œæ•´åŠŸèƒ½ã€?

## ğŸ—ï¸?æŠ€æœ¯æ¶æ?

### åç«¯å®ç°
- **SmsService**: çŸ­ä¿¡æœåŠ¡ç±»ï¼Œå¤„ç†éªŒè¯ç å‘é€å’ŒéªŒè¯
- **SmsController**: çŸ­ä¿¡æ§åˆ¶å™¨ï¼Œæä¾›APIæ¥å£
- **AliyunSmsConfig**: é˜¿é‡Œäº‘çŸ­ä¿¡é…ç½®ç±»
- **Redisç¼“å­˜**: å­˜å‚¨éªŒè¯ç å’Œå‘é€é™åˆ?
- **å‘é€é™åˆ?*: æ¯æ—¥é™åˆ¶ã€å‘é€é—´éš”ã€éªŒè¯ç è¿‡æœŸ

### å‰ç«¯å®ç°
- **SmsService**: çŸ­ä¿¡æœåŠ¡ç±»ï¼Œå¤„ç†APIè°ƒç”¨
- **SmsUtil**: çŸ­ä¿¡å·¥å…·ç±»ï¼Œå°è£…å¸¸ç”¨æ“ä½œ
- **UIé›†æˆ**: æ³¨å†Œé¡µé¢éªŒè¯ç è¾“å…¥å’Œå‘é€æŒ‰é’?
- **å€’è®¡æ—¶åŠŸèƒ?*: å‘é€é—´éš”å€’è®¡æ—¶æ˜¾ç¤?

## ğŸ”§ é…ç½®æ­¥éª¤

### 1. é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡é…ç½?

1. **å¼€é€šçŸ­ä¿¡æœåŠ?*
   - ç™»å½• [é˜¿é‡Œäº‘æ§åˆ¶å°](https://ecs.console.aliyun.com/)
   - æœç´¢"çŸ­ä¿¡æœåŠ¡"å¹¶å¼€é€?
   - å®Œæˆå®åè®¤è¯

2. **åˆ›å»ºçŸ­ä¿¡ç­¾å**
   - è¿›å…¥çŸ­ä¿¡æœåŠ¡æ§åˆ¶å?
   - é€‰æ‹©"å›½å†…æ¶ˆæ¯" > "ç­¾åç®¡ç†"
   - åˆ›å»ºç­¾åï¼Œå¦‚"MetaLinkr"
   - ç­‰å¾…å®¡æ ¸é€šè¿‡

3. **åˆ›å»ºçŸ­ä¿¡æ¨¡æ¿**
   - é€‰æ‹©"æ¨¡æ¿ç®¡ç†"
   - åˆ›å»ºéªŒè¯ç æ¨¡æ¿ï¼Œå¦‚ï¼š
     ```
     æ‚¨çš„éªŒè¯ç æ˜¯ï¼?{code}ï¼?åˆ†é’Ÿå†…æœ‰æ•ˆï¼Œè¯·å‹¿æ³„éœ²ã€?
     ```
   - ç­‰å¾…å®¡æ ¸é€šè¿‡

4. **è·å–AccessKey**
   - è¿›å…¥"è®¿é—®æ§åˆ¶" > "ç”¨æˆ·"
   - åˆ›å»ºRAMç”¨æˆ·æˆ–ä½¿ç”¨ä¸»è´¦å·
   - è·å–AccessKey IDå’ŒAccessKey Secret
   - æˆäºˆçŸ­ä¿¡æœåŠ¡æƒé™

### 2. åç«¯é…ç½®

æ›´æ–° `application.yml` æ–‡ä»¶ä¸­çš„é˜¿é‡Œäº‘çŸ­ä¿¡é…ç½®ï¼š

```yaml
# é˜¿é‡Œäº‘çŸ­ä¿¡é…ç½?
aliyun:
  sms:
    access-key-id: YOUR_ACCESS_KEY_ID        # æ›¿æ¢ä¸ºå®é™…çš„AccessKey ID
    access-key-secret: YOUR_ACCESS_KEY_SECRET # æ›¿æ¢ä¸ºå®é™…çš„AccessKey Secret
    sign-name: æ­å·ç³ç‚ç”µå­å•†åŠ¡                     # çŸ­ä¿¡ç­¾å
    template-code: SMS_326741025             # çŸ­ä¿¡æ¨¡æ¿ä»£ç 
    template-content: "æ‚¨çš„éªŒè¯ç æ˜¯ï¼?{code}ï¼?åˆ†é’Ÿå†…æœ‰æ•ˆï¼Œè¯·å‹¿æ³„éœ²ã€?
    expire-minutes: 5                        # éªŒè¯ç æœ‰æ•ˆæœŸï¼ˆåˆ†é’Ÿï¼‰
    daily-limit: 10                          # æ¯æ—¥å‘é€é™åˆ?
    send-interval: 60                        # å‘é€é—´éš”ï¼ˆç§’ï¼‰
    enabled: true                            # æ˜¯å¦å¯ç”¨çŸ­ä¿¡æœåŠ¡
    test-mode: true                          # æµ‹è¯•æ¨¡å¼ï¼ˆä¸å®é™…å‘é€çŸ­ä¿¡ï¼‰
    test-code: "123456"                      # æµ‹è¯•éªŒè¯ç ?
```

### 3. Redisé…ç½®

ç¡®ä¿RedisæœåŠ¡æ­£å¸¸è¿è¡Œï¼Œç”¨äºå­˜å‚¨ï¼š
- éªŒè¯ç ï¼š`sms:code:{phone}`
- å‘é€é™åˆ¶ï¼š`sms:limit:{phone}`
- å‘é€é—´éš”ï¼š`sms:interval:{phone}`

## ğŸš€ ä½¿ç”¨æµç¨‹

### 1. å‘é€éªŒè¯ç 
```javascript
// å‰ç«¯è°ƒç”¨
const success = await SmsUtil.sendCodeWithMessage(phone)
if (success) {
  // å¼€å§‹å€’è®¡æ—?
  startCountdown()
}
```

### 2. éªŒè¯éªŒè¯ç ?
```javascript
// å‰ç«¯è°ƒç”¨
const isValid = await SmsUtil.verifyCodeWithMessage(phone, code)
if (isValid) {
  // éªŒè¯æˆåŠŸï¼Œç»§ç»­æ³¨å†Œæµç¨?
}
```

### 3. åç«¯å¤„ç†
```java
// å‘é€éªŒè¯ç 
@PostMapping("/send")
public ApiResponse<SmsResponse> sendCode(@RequestParam String phone) {
    boolean success = smsService.sendVerificationCode(phone);
    // è¿”å›å‘é€ç»“æœå’Œå‰©ä½™æ¬¡æ•°
}

// éªŒè¯éªŒè¯ç ?
@PostMapping("/verify")
public ApiResponse<Boolean> verifyCode(@RequestBody SmsRequest request) {
    boolean isValid = smsService.verifyCode(request.getPhone(), request.getCode());
    // è¿”å›éªŒè¯ç»“æœ
}
```

## ğŸ“Š åŠŸèƒ½ç‰¹æ€?

### å‘é€é™åˆ?
- **æ¯æ—¥é™åˆ¶**: æ¯ä¸ªæ‰‹æœºå·æ¯æ—¥æœ€å¤šå‘é€?0æ¬?
- **å‘é€é—´éš?*: æ¯æ¬¡å‘é€é—´éš?0ç§?
- **éªŒè¯ç è¿‡æœ?*: éªŒè¯ç ?åˆ†é’Ÿå†…æœ‰æ•?
- **é˜²åˆ·æœºåˆ¶**: Redisç¼“å­˜é™åˆ¶

### å®‰å…¨ç‰¹æ€?
- **æ‰‹æœºå·éªŒè¯?*: ä¸¥æ ¼éªŒè¯æ‰‹æœºå·æ ¼å¼?
- **éªŒè¯ç æ ¼å¼?*: 6ä½æ•°å­—éªŒè¯ç 
- **ä¸€æ¬¡æ€§ä½¿ç”?*: éªŒè¯æˆåŠŸåç«‹å³åˆ é™?
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ?

### ç”¨æˆ·ä½“éªŒ
- **å€’è®¡æ—¶æ˜¾ç¤?*: å‘é€åæ˜¾ç¤ºå€’è®¡æ—?
- **åŠ è½½çŠ¶æ€?*: å‘é€æ—¶æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
- **é”™è¯¯æç¤º**: å‹å¥½çš„é”™è¯¯æç¤ºä¿¡æ?
- **æµ‹è¯•æ¨¡å¼**: å¼€å‘ç¯å¢ƒæµ‹è¯•æ”¯æŒ?

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### 1. åç«¯æµ‹è¯•
```bash
# æµ‹è¯•å‘é€éªŒè¯ç 
curl -X POST "http://localhost:8082/api/sms/send?phone=13800138000"

# æµ‹è¯•éªŒè¯éªŒè¯ç ?
curl -X POST "http://localhost:8082/api/sms/verify" \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","code":"123456"}'

# æµ‹è¯•å‘é€çŠ¶æ€?
curl "http://localhost:8082/api/sms/status?phone=13800138000"

# æµ‹è¯•æ¨¡å¼å‘é€?
curl -X POST "http://localhost:8082/api/sms/test?phone=13800138000"
```

### 2. å‰ç«¯æµ‹è¯•
1. å¯åŠ¨å‰ç«¯åº”ç”¨: `npm run dev`
2. å¯åŠ¨åç«¯åº”ç”¨: `mvn spring-boot:run`
3. è®¿é—®æ³¨å†Œé¡µé¢ï¼Œè¾“å…¥æ‰‹æœºå·
4. ç‚¹å‡»"è·å–éªŒè¯ç ?æŒ‰é’®
5. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—å’Œç½‘ç»œè¯·æ±?

### 3. æµ‹è¯•æ¨¡å¼
åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥å¯ç”¨æµ‹è¯•æ¨¡å¼ï¼š
```yaml
aliyun:
  sms:
    test-mode: true
    test-code: "123456"
```

æµ‹è¯•æ¨¡å¼ä¸‹ä¸ä¼šå®é™…å‘é€çŸ­ä¿¡ï¼Œç›´æ¥è¿”å›æµ‹è¯•éªŒè¯ç ã€?

## ğŸ“ APIæ¥å£

### å‘é€éªŒè¯ç 
```
POST /api/sms/send
å‚æ•°: phone (æ‰‹æœºå?
å“åº”: {
  "success": true,
  "data": {
    "success": true,
    "message": "éªŒè¯ç å‘é€æˆåŠ?,
    "remainingCount": 9,
    "nextSendTime": 60
  }
}
```

### éªŒè¯éªŒè¯ç ?
```
POST /api/sms/verify
è¯·æ±‚: {
  "phone": "13800138000",
  "code": "123456",
  "type": "register"
}
å“åº”: {
  "success": true,
  "data": true,
  "message": "éªŒè¯ç éªŒè¯æˆåŠ?
}
```

### æŸ¥è¯¢å‘é€çŠ¶æ€?
```
GET /api/sms/status?phone=13800138000
å“åº”: {
  "success": true,
  "data": {
    "remainingCount": 9,
    "nextSendTime": 30
  }
}
```

### æµ‹è¯•å‘é€?
```
POST /api/sms/test?phone=13800138000
å“åº”: {
  "success": true,
  "data": {
    "success": true,
    "message": "æµ‹è¯•æ¨¡å¼ï¼ŒéªŒè¯ç å·²ç”Ÿæˆ?,
    "code": "123456"
  }
}
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **AccessKeyå®‰å…¨**: å¦¥å–„ä¿ç®¡AccessKeyï¼Œä¸è¦æ³„éœ?
2. **å‘é€é™åˆ?*: é˜²æ­¢æ¶æ„åˆ·çŸ­ä¿?
3. **éªŒè¯ç å®‰å…?*: éªŒè¯ç æœ‰æ•ˆæœŸçŸ­ï¼Œä¸€æ¬¡æ€§ä½¿ç”?
4. **æ‰‹æœºå·éªŒè¯?*: ä¸¥æ ¼éªŒè¯æ‰‹æœºå·æ ¼å¼?
5. **é”™è¯¯å¤„ç†**: ä¸æš´éœ²æ•æ„Ÿä¿¡æ?

## ğŸ› å¸¸è§é—®é¢˜

### 1. çŸ­ä¿¡å‘é€å¤±è´?
**é—®é¢˜**: è¿”å›é”™è¯¯ç é"OK"
**è§£å†³**: æ£€æŸ¥AccessKeyã€ç­¾åã€æ¨¡æ¿æ˜¯å¦æ­£ç¡?

### 2. éªŒè¯ç éªŒè¯å¤±è´?
**é—®é¢˜**: éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœ?
**è§£å†³**: æ£€æŸ¥Redisè¿æ¥ï¼Œç¡®è®¤éªŒè¯ç æœªè¿‡æœ?

### 3. å‘é€é™åˆ?
**é—®é¢˜**: è¶…è¿‡æ¯æ—¥å‘é€é™åˆ?
**è§£å†³**: ç­‰å¾…ç¬¬äºŒå¤©é‡ç½®æˆ–è°ƒæ•´é™åˆ¶é…ç½®

### 4. Redisè¿æ¥å¤±è´¥
**é—®é¢˜**: éªŒè¯ç æ— æ³•å­˜å‚?
**è§£å†³**: æ£€æŸ¥RedisæœåŠ¡çŠ¶æ€å’Œé…ç½®

## ğŸ“ˆ åç»­ä¼˜åŒ–

1. **çŸ­ä¿¡æ¨¡æ¿**: æ”¯æŒå¤šç§çŸ­ä¿¡æ¨¡æ¿
2. **å‘é€ç»Ÿè®?*: æ·»åŠ çŸ­ä¿¡å‘é€ç»Ÿè®¡åŠŸèƒ?
3. **é»‘ç™½åå•**: æ”¯æŒæ‰‹æœºå·é»‘ç™½åå?
4. **æ‰¹é‡å‘é€?*: æ”¯æŒæ‰¹é‡å‘é€éªŒè¯ç 
5. **å›½é™…åŒ?*: æ”¯æŒå›½é™…çŸ­ä¿¡å‘é€?

## ğŸ“ æŠ€æœ¯æ”¯æŒ?

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡é…ç½®æ˜¯å¦æ­£ç¡?
2. AccessKeyæƒé™æ˜¯å¦è¶³å¤Ÿ
3. RedisæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
4. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
5. æ§åˆ¶å°é”™è¯¯æ—¥å¿?

---

**æ³¨æ„**: è¯·å°†é…ç½®ä¸­çš„ `YOUR_ACCESS_KEY_ID` å’?`YOUR_ACCESS_KEY_SECRET` æ›¿æ¢ä¸ºå®é™…çš„é˜¿é‡Œäº‘AccessKeyã€?
