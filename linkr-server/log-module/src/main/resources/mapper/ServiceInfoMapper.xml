<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aleks.linkrmix.log.mapper.ServiceInfoMapper">

    <!-- 获取所有服务信息 -->
    <select id="selectList" resultType="com.aleks.linkrmix.log.model.entity.ServiceInfo">
        SELECT * FROM service_info WHERE deleted = 0 ORDER BY create_time DESC
    </select>

    <!-- 根据ID获取服务信息 -->
    <select id="selectById" resultType="com.aleks.linkrmix.log.model.entity.ServiceInfo">
        SELECT * FROM service_info WHERE id = #{id} AND deleted = 0
    </select>

    <!-- 根据名称获取服务信息 -->
    <select id="selectByName" resultType="com.aleks.linkrmix.log.model.entity.ServiceInfo">
        SELECT * FROM service_info WHERE name = #{name} AND deleted = 0
    </select>

    <!-- 插入服务信息 -->
    <insert id="insert" parameterType="com.aleks.linkrmix.log.model.entity.ServiceInfo">
        INSERT INTO service_info (
            id, name, status, log_path, last_update, log_count, error_count, 
            create_time, update_time, deleted
        ) VALUES (
            #{id}, #{name}, #{status}, #{logPath}, #{lastUpdate}, #{logCount}, #{errorCount},
            NOW(), NOW(), 0
        )
    </insert>

    <!-- 更新服务信息 -->
    <update id="updateById" parameterType="com.aleks.linkrmix.log.model.entity.ServiceInfo">
        UPDATE service_info SET
            name = #{name},
            status = #{status},
            log_path = #{logPath},
            last_update = #{lastUpdate},
            log_count = #{logCount},
            error_count = #{errorCount},
            update_time = NOW()
        WHERE id = #{id} AND deleted = 0
    </update>

    <!-- 逻辑删除服务信息 -->
    <update id="deleteById">
        UPDATE service_info SET deleted = 1, update_time = NOW() WHERE id = #{id}
    </update>

</mapper>
