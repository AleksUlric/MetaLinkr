<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aleks.linkrmix.log.mapper.AlertRuleMapper">

    <!-- 获取所有告警规则 -->
    <select id="selectList" resultType="com.aleks.linkrmix.log.model.entity.AlertRule">
        SELECT * FROM alert_rule WHERE deleted = 0 ORDER BY create_time DESC
    </select>

    <!-- 根据ID获取告警规则 -->
    <select id="selectById" resultType="com.aleks.linkrmix.log.model.entity.AlertRule">
        SELECT * FROM alert_rule WHERE id = #{id} AND deleted = 0
    </select>

    <!-- 根据名称获取告警规则 -->
    <select id="selectByName" resultType="com.aleks.linkrmix.log.model.entity.AlertRule">
        SELECT * FROM alert_rule WHERE name = #{name} AND deleted = 0
    </select>

    <!-- 插入告警规则 -->
    <insert id="insert" parameterType="com.aleks.linkrmix.log.model.entity.AlertRule">
        INSERT INTO alert_rule (
            id, name, rule_condition, level, notification_methods, enabled,
            create_time, update_time, deleted
        ) VALUES (
            #{id}, #{name}, #{ruleCondition}, #{level}, #{notificationMethods}, #{enabled},
            NOW(), NOW(), 0
        )
    </insert>

    <!-- 更新告警规则 -->
    <update id="updateById" parameterType="com.aleks.linkrmix.log.model.entity.AlertRule">
        UPDATE alert_rule SET
            name = #{name},
            rule_condition = #{ruleCondition},
            level = #{level},
            notification_methods = #{notificationMethods},
            enabled = #{enabled},
            update_time = NOW()
        WHERE id = #{id} AND deleted = 0
    </update>

    <!-- 逻辑删除告警规则 -->
    <update id="deleteById">
        UPDATE alert_rule SET deleted = 1, update_time = NOW() WHERE id = #{id}
    </update>

</mapper>


